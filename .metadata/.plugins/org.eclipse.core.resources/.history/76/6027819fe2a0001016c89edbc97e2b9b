package com.example.Backend.Controller;

import com.example.Backend.Customer.Customer;
import com.example.Backend.Repository.CustomerRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/auth")
public class AuthController {

    @Autowired
    private CustomerRepository customerRepository;

    @Autowired
    private BCryptPasswordEncoder passwordEncoder;

    // DTO for login request
    public static class LoginRequest {
        public String email;
        public String password;
    }

    // DTO for login response
    public static class LoginResponse {
        public boolean success;
        public String message;
        public String role; // Add this field

        public LoginResponse(boolean success, String message, String role) {
            this.success = success;
            this.message = message;
            this.role = role;
        }
    }

    @PostMapping("/login")
    public LoginResponse login(@RequestBody LoginRequest request) {
        Customer customer = customerRepository.findByCEmail(request.email).orElse(null);
        if (customer == null) {
            return new LoginResponse(false, "Customer not found", null);
        }
        if (passwordEncoder.matches(request.password, customer.getC_password())) {
            return new LoginResponse(true, "Login success!", customer.getRole());
        } else {
            return new LoginResponse(false, "Invalid password", null);
        }
    }
}
